!function(r){"use strict";r.CustomFormSelect=function(t,e){return this.customForm=t,r.extend(r.CustomFormSelect.prototype,r.CustomForm.prototype),this.elements={body:r("body"),context:this.customForm.elementContext,input:this.customForm.elementInput,wrapper:null,wrapperInput:null,source:{options:null,optgroups:null},wrapperLabel:null,wrapperOptions:null},r.extend(!0,this.settings={},this.customForm.settings,r.CustomFormSelect.defaults,e),this.type=this.customForm.support.type,this.multiple=this.getInput().prop("multiple"),this.multipleOptions=[],this.keyboard={timeout:null,keyCodeToKey:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"},search:[],options:{}},this.prepareUserOptions()&&this.init(),this},r.CustomFormSelect.defaults={classes:{label:"{prefix}-selectLabel",options:"{prefix}-selectOptions",option:"{prefix}-selectOption",optionGroup:"{prefix}-selectOptionGroup",optionGroupLabel:"{prefix}-selectOptionGroupLabel",first:"is-first",last:"is-last",selected:"is-selected",preselected:"is-preselected",multiple:"is-multiple",open:"is-open"},multipleOptionsSeparator:", ",beforeLoad:void 0,beforeWrap:void 0,afterEventsHandler:void 0,onComplete:void 0,onClick:void 0,onChange:void 0,onReset:void 0},r.CustomFormSelect.prototype={init:function(){return void 0!==this.settings.beforeLoad&&this.settings.beforeLoad.call({customFormSelect:this,elements:this.getElements()}),this.wrap(),this.reset(),this.eventsHandler(),void 0!==this.settings.onComplete&&this.settings.onComplete.call({customFormSelect:this,elements:this.getElements()}),this},wrap:function(){var i=this;return i.elements.wrapper=r("<span>",{class:i.settings.classes.prefix+" "+i.settings.classes.prefix+"--"+i.getInputType()}),i.elements.wrapperInput=r("<span>",{class:i.settings.classes.input}),void 0!==i.settings.beforeWrap&&i.settings.beforeWrap.call({customForm:i,elements:i.getElements()}),i.getInput().parent().wrapInner(i.getWrapper()),i.elements.wrapper=i.getInput().parent(),i.getInput().wrap(i.getWrapperInput()),i.elements.wrapperInput=i.getInput().parent(),i.elements.source.options=i.getInput().children("option"),i.elements.source.optgroups=i.getInput().children("optgroup"),i.getWrapperInput().append(r("<span>",{class:i.settings.classes.label})),i.elements.wrapperLabel=i.getInput().next(),i.getWrapperInput().append(r("<span>",{class:i.settings.classes.options})),i.elements.wrapperOptions=i.getWrapperLabel().next(),i.getInput().attr("tabindex","-1"),i.isDisabled()||i.getWrapperLabel().attr("tabindex",i.settings.tabindexStart),i.isMultiple()&&i.getWrapper().addClass(i.settings.classes.multiple),i.getSourceOptions().length&&r.each(i.getSourceOptions(),function(t,e){var s=(e=r(e)).attr("class");i.getWrapperOptions().append(r("<span>",{class:i.settings.classes.option+(void 0!==s?" "+s:"")+(void 0!==e.attr("disabled")?" "+i.settings.classes.disabled:""),"data-value":e.val(),html:e.html()}))}),i.getSourceOptgroups().length&&r.each(i.getSourceOptgroups(),function(t,e){e=r(e);var o=r("<span>",{class:i.settings.classes.optionGroup});r("<span>",{class:i.settings.classes.optionGroupLabel,html:e.attr("label")}).appendTo(o),e.children("option").each(function(t,e){var s=(e=r(e)).attr("class");r("<span>",{class:i.settings.classes.option+(void 0!==s?" "+s:"")+(void 0!==e.attr("disabled")?" "+i.settings.classes.disabled:""),"data-value":e.val(),html:e.html()}).appendTo(o)}),i.getWrapperOptions().append(o)}),i.getOptions().first().addClass(i.settings.classes.first).end().last().addClass(i.settings.classes.last),i},reset:function(){var s,t,e=this,n=e.getDefaultValue();return e.getWrapper().removeClass(e.settings.classes.disabled+" "+e.settings.classes.required),e.isDisabled()&&(e.getWrapper().addClass(e.settings.classes.disabled),e.getWrapperLabel().removeAttr("tabindex")),e.isRequired()&&e.getWrapper().addClass(e.settings.classes.required),void 0===n&&(0===(n=e.getSourceOptions().filter("[selected]")).length&&(n=e.getSourceOptions().first()),n=1<n.length?(s=[],r.each(n,function(t,e){s.push(r(e).val())}),s.join(",")):n.val(),e.getInput().attr("data-default-value",n)),e.isMultiple()&&(t=e.loadOption("."+e.settings.classes.first),n===t.getValue()&&(n=null,e.setLabel(t.getName()))),e.getOptions().each(function(t,s){var o=(s=e.loadOption(s)).getValue(),i={context:"init"};e.isMultiple()&&null!==n?("string"==typeof n&&(n=n.split(",")),s.unselect(),r.each(n,function(t,e){o===e&&s.select(i)})):o===n&&s.select(i)}),e},eventsHandler:function(){var e=this;e.getWrapperLabel().on("click.customform.open keydown.customform.open",function(t){e.getInput().is(":disabled")||("click"===t.type?e.clickHandler(t):"keydown"===t.type&&e.keyboardHandler(t))}),e.getContext().on("reset.customform",function(t){e.onReady(function(){e.reset(),void 0!==e.settings.onReset&&e.settings.onReset.call({customFormSelect:e,form:r(t.currentTarget)})})}),void 0!==e.settings.afterEventsHandler&&e.settings.afterEventsHandler.call({customFormSelect:e,elements:e.getElements()})},clickHandler:function(t){var s=this;s.closeSiblings(),s.getWrapperLabel().one("click.customform.close",{self:s},s.close),s.getElements().body.on("click.customform.close",function(t){var e=r(t.target);(!s.isMultiple()&&e.hasClass(s.settings.classes.option)||!e.hasClass(s.settings.classes.label)&&!e.hasClass(s.settings.classes.option))&&s.close()}),s.getWrapper().addClass(s.settings.classes.open),s.getOptions().on("click.customform.option",function(t){s.loadOption(t.currentTarget).select({context:t.type})}),s.getInput().triggerHandler("click"),void 0!==s.settings.onClick&&s.settings.onClick.call({customFormSelect:s,event:t,elements:s.getElements(),options:s.getOptions()})},keyboardHandler:function(t){var e,s=this,o=null,i=0,n=0,l="Enter"===t.key,r=32===t.keyCode,a=37===t.keyCode||38===t.keyCode?"up":39===t.keyCode||40===t.keyCode?"down":void 0,p=35===t.keyCode||t.metaKey&&"down"===a?"last":36===t.keyCode||t.metaKey&&"up"===a?"first":void 0,c=27===t.keyCode||l||9===t.keyCode,u=48<=t.keyCode&&t.keyCode<=105;if(r||l)return t.preventDefault(),void(s.isMultiple()?(o=s.getOptions("."+s.settings.classes.preselected),s.getWrapper().hasClass(s.settings.classes.open)?o.length&&(o=s.loadOption(o)).select():s.clickHandler(t)):s.clickHandler(t));c?s.close():(s.getOptions().each(function(t,e){e=s.loadOption(e),s.keyboard.options[t]=e,s.isMultiple()?e.hasState("preselected")&&(i=t):e.isSelected()&&(i=t),n++}),void 0===a&&void 0===p||(t.preventDefault(),s.closeSiblings(),void 0!==p?o="last"===(a=p)?s.keyboard.options[n-1]:s.isMultiple()?s.keyboard.options[1]:s.keyboard.options[0]:"up"===a?o=s.keyboard.options[i-1]:"down"===a&&(o=s.keyboard.options[i+1]),null!=o&&(o[s.isMultiple()?"focus":"select"]({context:"keydown",direction:a}),s.autoscrollWrapperOptions(o,a))),!u||void 0!==(e=void 0!==t.key?t.key:s.keyboard.keyCodeToKey[t.keyCode])&&(clearTimeout(s.keyboard.timeout),s.keyboard.search.push(e),s.keyboard.timeout=setTimeout(function(){null!==(o=s.getOptionOnkeyboard())&&o.select({context:"keydown"})},250)),s.getInput().triggerHandler(t.type))},getOptionOnkeyboard:function(){var s=this,t=null,o=this.keyboard.search.join(""),i=[],n=[];return this.getOptions().each(function(t,e){e=s.loadOption(e),i.push(e.getName().toLowerCase().indexOf(o))}),i.length&&r.each(i,function(t,e){-1!==e&&n.push(t)}),n.length&&(n=n.shift(),"object"==typeof this.keyboard.options[n]&&(t=this.keyboard.options[n])),this.keyboard.search=[],t},autoscrollWrapperOptions:function(t,e){var s,o,i,n,l,r=this;"first"===e||"last"===e?r.getWrapperOptions().scrollTop("first"===e?0:r.getWrapperOptions()[0].scrollHeight):(s=parseInt(t.getOption().position().top),o=parseInt(r.getWrapperOptions().scrollTop()),n=!1,Math.round(r.getWrapperOptions().outerHeight())-(i=Math.round(t.getOption().outerHeight()))<s?(r.getWrapperOptions().scrollTop(o+i),n=!0):s<0&&(r.getWrapperOptions().scrollTop(o-i),n=!0),!n||(l=r.loadOption(t.getOption()["up"===e?"prev":"next"]())).getOption().length&&l.isDisabled()&&r.autoscrollWrapperOptions(l,e))},close:function(t){var e=void 0!==t&&void 0!==t.data&&void 0!==t.data.self?t.data.self:this;return e.getWrapper().removeClass(e.settings.classes.open),e.getWrapperLabel().off("click.customform.close"),e.getOptions().off("click.customform.option"),e.getElements().body.off("click.customform.close"),e},closeSiblings:function(){var s=this,t=s.getSiblings();return t.length&&(t.each(function(t,e){r(e).removeClass(s.settings.classes.open).find("."+s.settings.classes.label).off("click.customform.close").end().find("."+s.settings.classes.option).off("click.customform.option")}),s.getElements().body.off("click.customform.close")),s},setLabel:function(t,e){return this.isMultiple()&&("object"==typeof e&&(e=e.join(",")),"object"==typeof t&&(t=t.join(this.settings.multipleOptionsSeparator))),void 0!==e&&this.getWrapperLabel().attr("data-value",e),this.getWrapperLabel().html(t),this},isMultiple:function(){return this.multiple},getSiblings:function(){return this.getContext().find("."+this.settings.classes.prefix+"--"+this.getInputType()).not(this.getWrapper())},getWrapperLabel:function(){return this.getElements().wrapperLabel},getValue:function(t){var e=(t=t||!1)?this.getInput().attr("data-default-value"):this.getWrapperLabel().attr("data-value");return void 0!==e&&this.isMultiple()?e.split(","):e},getCurrentValue:function(){return this.getValue()},getDefaultValue:function(){return this.getValue(!0)},getWrapperOptions:function(){return this.getElements().wrapperOptions},getOptions:function(t){var e=this.getWrapperOptions().find("."+this.settings.classes.option);return void 0!==t?e.filter(t):e},selectOptions:function(t){var s=this;if(t=void 0===t||"string"==typeof t?s.getOptions(t):t,s.isMultiple())return t.length&&t.each(function(t,e){(e=s.loadOption(e)).select()}),s;s.setLog('selectOptions() works only with "multiple" attribute. Use loadOption().select() for classic <select>.',"warn")},unselectOptions:function(t,s){var o=this;if(t=void 0===t||"string"==typeof t?o.getOptions(t):t,s=s||!1,o.isMultiple())return t.length&&r.each(t,function(t,e){(e=o.loadOption(e)).isSelected()&&e.unselect(),s&&e.disable()}),0===o.getOptions(".is-selected").length&&o.reset(),o;o.setLog('removeOptions() works only with "multiple" attribute. Use loadOption().select() for classic <select>.',"warn")},getOptionFromValue:function(t){return this.getOptions('[data-value="'+t+'"]')},getSourceOptions:function(){return this.getElements().source.options},getSourceOptgroups:function(){return this.getElements().source.optgroups},loadOption:function(t){return"string"==typeof t&&(t=this.getOptions(t)),new r.CustomFormSelectOption(this,t)}},r.CustomFormSelectOption=function(t,e){return"object"!=typeof e||e instanceof jQuery||(e=r(e)),this.customForm=t.customForm,this.customFormSelect=t,this.option=e,this},r.CustomFormSelectOption.prototype={getOption:function(){return this.option},select:function(t){var i,n,e,s,l=this,o={};if(t=t||{},void 0!==l.getOption()&&null!==l.getOption()&&l.getOption().length&&void 0!==l.getValue()){if(l.isDisabled()&&void 0!==t.direction)return l.option=l.getOption()["up"===t.direction?"prev":"next"](),void l.select({context:"auto-move",direction:t.direction});if(l.isDisabled())return;l.customFormSelect.isMultiple()?(i=[],n=[],1===l.customFormSelect.multipleOptions.length&&l.customFormSelect.multipleOptions[0].isFirst()&&(l.customFormSelect.getInput().empty(),l.customFormSelect.multipleOptions[0].removeState("selected"),l.customFormSelect.multipleOptions=[]),l.isSelected()?(l.customFormSelect.multipleOptions=[],l.removeState("selected"),l.customFormSelect.getOptions("."+l.customFormSelect.settings.classes.selected).each(function(t,e){l.customFormSelect.multipleOptions.push(l.customFormSelect.loadOption(e))}),0===l.customFormSelect.multipleOptions.length&&(void 0===t.context||void 0!==t.context&&"unselect"!==t.context)&&l.customFormSelect.onReady(function(){l.customFormSelect.loadOption("."+l.customFormSelect.settings.classes.first).select(t)})):l.customFormSelect.multipleOptions.push(l),l.customFormSelect.multipleOptions.sort(function(t,e){var s=l.customFormSelect.getOptions();return(t=s.index(t))===(e=s.index(e))?0:t<e?-1:1}),l.customFormSelect.getInput().empty(),l.customFormSelect.getOptions().removeClass(l.customFormSelect.settings.classes.selected),r.each(l.customFormSelect.multipleOptions,function(t,e){var s,o;e.isDisabled()||(s=e.getValue(),o=e.getName(),i.push(s),n.push(o),l.customFormSelect.getInput().append(r("<option>",{value:s,html:o}).prop("selected",!0)),e.addState("selected"))}),l.customFormSelect.setLabel(n,i),void 0!==l.customFormSelect.settings.onChange&&(o=r.extend(o,{options:l.customFormSelect.multipleOptions}))):(e=l.getValue(),s=l.getName(),l.customFormSelect.getInput().html(r("<option>",{value:e,html:s}).prop("selected",!0)),l.customFormSelect.setLabel(s,e),l.customFormSelect.getOptions().removeClass(l.customFormSelect.settings.classes.selected),l.addState("selected"),void 0!==l.customFormSelect.settings.onChange&&(o=r.extend(o,{option:l}))),"init"!==t.context&&(l.customFormSelect.getInput().triggerHandler("change"),void 0!==l.customFormSelect.settings.onChange&&(o=r.extend({customFormSelect:l.customFormSelect,elements:l.customFormSelect.getElements(),settings:t},o),l.customFormSelect.settings.onChange.call(o)))}return l},unselect:function(){return this.isSelected()&&(this.customFormSelect.isMultiple()?this.select({context:"unselect"}):this.customFormSelect.reset()),this},focus:function(t){var e=this;if(t=t||{},void 0!==e.getOption()&&null!==e.getOption()&&e.getOption().length&&void 0!==e.getValue()){if(e.isDisabled()&&void 0!==t.direction)return e.option=e.getOption()["up"===t.direction?"prev":"next"](),void e.focus({context:"auto-move",direction:t.direction});if(e.isDisabled()||e.isFirst())return;e.customFormSelect.getOptions().removeClass(e.customFormSelect.settings.classes.preselected),e.addState("preselected")}return e},addState:function(t){return this.getOption().addClass(this.customFormSelect.settings.classes[t]),this},hasState:function(t){return this.getOption().hasClass(this.customFormSelect.settings.classes[t])},removeState:function(t){return this.getOption().removeClass(this.customFormSelect.settings.classes[t]),this},disable:function(){return this.addState("disabled")},isSelected:function(){return this.hasState("selected")},isFirst:function(){return this.hasState("first")},isLast:function(){return this.hasState("last")},isDisabled:function(){return this.hasState("disabled")},getName:function(){return this.getOption().html()},setName:function(t){return this.getOption().html(t),this},getValue:function(){return void 0!==this.getOption()?this.getOption().attr("data-value"):null},setValue:function(t){return this.getOption().attr("data-value",t),this}}}(jQuery);