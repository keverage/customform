!function(u){"use strict";u.CustomFormSelect=function(e,t){return this.customForm=e,this.elements={body:u("body"),context:this.customForm.elementContext,input:this.customForm.elementInput,wrapper:null,wrapperInput:null,source:{options:null,optgroups:null},wrapperLabel:null,wrapperOptions:null},u.extend(!0,this.settings={},this.customForm.settings,u.CustomFormSelect.defaults,t),this.type=this.customForm.support.type,this.multiple=this.getInput().prop("multiple"),this.multipleOptions=[],this.keyboard={timeout:null,keyCodeToKey:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"},search:[],options:{}},this.prepareOptions()&&this.init(),this},u.CustomFormSelect.defaults={classes:{label:"{prefix}-selectLabel",options:"{prefix}-selectOptions",option:"{prefix}-selectOption",optionGroup:"{prefix}-selectOptionGroup",optionGroupLabel:"{prefix}-selectOptionGroupLabel",first:"is-first",last:"is-last",selected:"is-selected",multiple:"is-multiple",open:"is-open"},multipleOptionsSeparator:", ",beforeLoad:void 0,beforeWrap:void 0,afterEventsHandler:void 0,onComplete:void 0,onClick:void 0,onChange:void 0,onReset:void 0},u.CustomFormSelect.prototype={prepareOptions:function(){return this.customForm.replacePrefixClass.call(this),!0},init:function(){return void 0!==this.settings.beforeLoad&&this.settings.beforeLoad.call({customFormSelect:this,elements:this.getElements()}),this.wrap(),this.reset(),this.eventsHandler(),void 0!==this.settings.onComplete&&this.settings.onComplete.call({customFormSelect:this,elements:this.getElements()}),this},wrap:function(){var i=this;return i.elements.wrapper=u("<span>",{class:i.settings.classes.prefix+" "+i.settings.classes.prefix+"--"+i.getInputType()}),i.elements.wrapperInput=u("<span>",{class:i.settings.classes.input,tabindex:i.settings.tabindexStart}),void 0!==i.settings.beforeWrap&&i.settings.beforeWrap.call({customForm:i,elements:i.getElements()}),i.getInput().parent().wrapInner(i.getWrapper()),i.elements.wrapper=i.getInput().parent(),i.getInput().wrap(i.getWrapperInput()),i.elements.wrapperInput=i.getInput().parent(),i.elements.source.options=i.getInput().children("option"),i.elements.source.optgroups=i.getInput().children("optgroup"),i.getWrapperInput().append(u("<span>",{class:i.settings.classes.label})),i.elements.wrapperLabel=i.getInput().next(),i.getWrapperInput().append(u("<span>",{class:i.settings.classes.options})),i.elements.wrapperOptions=i.getWrapperLabel().next(),i.getWrapperInput().removeAttr("tabindex"),i.getWrapperLabel().attr("tabindex",i.settings.tabindexStart),i.isMultiple()&&i.getWrapper().addClass(i.settings.classes.multiple),i.getSourceOptions().length&&u.each(i.getSourceOptions(),function(e,t){var s=(t=u(t)).attr("class");i.getWrapperOptions().append(u("<span>",{class:i.settings.classes.option+(void 0!==s?" "+s:"")+(void 0!==t.attr("disabled")?" "+i.settings.classes.disabled:""),"data-value":t.val(),html:t.html()}))}),i.getSourceOptgroups().length&&u.each(i.getSourceOptgroups(),function(e,t){t=u(t);var n=u("<span>",{class:i.settings.classes.optionGroup});u("<span>",{class:i.settings.classes.optionGroupLabel,html:t.attr("label")}).appendTo(n),t.children("option").each(function(e,t){var s=(t=u(t)).attr("class");u("<span>",{class:i.settings.classes.option+(void 0!==s?" "+s:"")+(void 0!==t.attr("disabled")?" "+i.settings.classes.disabled:""),"data-value":t.val(),html:t.html()}).appendTo(n)}),i.getWrapperOptions().append(n)}),i.getOptions().first().addClass(i.settings.classes.first).end().last().addClass(i.settings.classes.last),i},reset:function(){var o=this,t=o.getDefaultValue();if(o.getWrapper().removeClass(o.settings.classes.disabled),o.getInput().is(":disabled")&&(o.getWrapper().addClass(o.settings.classes.disabled),o.getInput().removeAttr("tabindex"),o.getWrapperLabel().removeAttr("tabindex")),void 0===t){if(0===(t=o.getSourceOptions().filter("[selected]")).length&&(t=o.getSourceOptions().first()),1<t.length){var s=[];u.each(t,function(e,t){s.push(u(t).val())}),t=s.join(",")}else t=t.val();o.getInput().attr("data-default-value",t)}if(o.isMultiple()){var e=o.getOptions(".is-first"),n=o.getOptionValue(e);t===n&&(t=null,o.setLabel(e.html()))}return o.getOptions().each(function(e,s){s=u(s);var n=o.getOptionValue(s),i={context:"init"};o.isMultiple()&&null!==t?("string"==typeof t&&(t=t.split(",")),u.each(t,function(e,t){n===t&&o.setOption(s,i)})):n===t&&o.setOption(s,i)}),o},eventsHandler:function(){var t=this;t.getWrapperLabel().on("click.customform.open keydown.customform.open",function(e){t.getInput().is(":disabled")||("click"===e.type?t.clickHandler(e):"keydown"===e.type&&t.keyboardHandler(e))}),t.getContext().on("reset.customform",function(e){t.reset(),void 0!==t.settings.onReset&&t.settings.onReset.call({customFormSelect:t,form:u(e.currentTarget)})}),void 0!==t.settings.afterEventsHandler&&t.settings.afterEventsHandler.call({customFormSelect:t,elements:t.getElements()})},close:function(e){var t=void 0!==e&&void 0!==e.data&&void 0!==e.data.self?e.data.self:this;return t.getWrapper().removeClass(t.settings.classes.open),t.getWrapperLabel().off("click.customform.close"),t.getOptions().off("click.customform.option"),t.getElements().body.off("click.customform.close"),t},closeSiblings:function(){var s=this,e=s.getSiblings();return e.length&&(e.each(function(e,t){u(t).removeClass(s.settings.classes.open).find("."+s.settings.classes.label).off("click.customform.close").end().find("."+s.settings.classes.option).off("click.customform.option")}),s.getElements().body.off("click.customform.close")),s},clickHandler:function(e){var s=this;s.closeSiblings(),s.getWrapperLabel().one("click.customform.close",{self:s},s.close),s.getElements().body.on("click.customform.close",function(e){var t=u(e.target);(!s.isMultiple()&&t.hasClass(s.settings.classes.option)||!t.hasClass(s.settings.classes.label)&&!t.hasClass(s.settings.classes.option))&&s.close()}),s.getWrapper().addClass(s.settings.classes.open),s.getOptions().on("click.customform.option",function(e){s.setOption(u(e.currentTarget),{context:"click"})}),s.getInput().triggerHandler("click"),void 0!==s.settings.onClick&&s.settings.onClick.call({customFormSelect:s,event:e,elements:s.getElements(),options:s.getOptions()})},keyboardHandler:function(e){var s=this,t=null,n=null,i=0,o=37===e.keyCode||38===e.keyCode?"up":39===e.keyCode||40===e.keyCode?"down":void 0,l=35===e.keyCode?"last":36===e.keyCode?"first":void 0,r=27===e.keyCode||13===e.keyCode||9===e.keyCode,a=48<=e.keyCode&&e.keyCode<=105;if(32===e.keyCode)e.preventDefault();else if(r)s.close();else{if(s.getOptions().each(function(e,t){t=u(t),s.keyboard.options[e]=t,s.isSelected(t)&&(n=e),i++}),void 0!==o||void 0!==l){if(e.preventDefault(),s.closeSiblings(),s.isMultiple())return;"up"===o?t=s.keyboard.options[n-1]:"down"===o?t=s.keyboard.options[n+1]:void 0!==l&&(t="last"===l?s.keyboard.options[i-1]:s.keyboard.options[0]),null!==t&&s.setOption(t,{context:"keydown",direction:o})}if(a){var p=void 0!==e.key?e.key:s.keyboard.keyCodeToKey[e.keyCode];void 0!==p&&(clearTimeout(s.keyboard.timeout),s.keyboard.search.push(p),s.keyboard.timeout=setTimeout(function(){s.setOption(s.getOptionOnkeyboard(),{context:"keydown"})},250))}s.getInput().triggerHandler(e.type)}},getOptionOnkeyboard:function(){var e=null,s=this.keyboard.search.join(""),n=[],i=[];return this.getOptions().each(function(e,t){t=u(t),n.push(t.html().toLowerCase().indexOf(s))}),n.length&&u.each(n,function(e,t){-1!==t&&i.push(e)}),i.length&&(i=i.shift(),this.keyboard.options[i].length&&(e=this.keyboard.options[i])),this.keyboard.search=[],e},setLabel:function(e,t){return this.isMultiple()&&("object"==typeof t&&(t=t.join(",")),"object"==typeof e&&(e=e.join(this.settings.multipleOptionsSeparator))),void 0!==t&&this.getWrapperLabel().attr("data-value",t),this.getWrapperLabel().html(e),this},setOption:function(e,t){var i=this,s={};if(e="string"==typeof e?i.getOptions(e):e,t=t||{},null!=e&&e.length&&void 0!==i.getOptionValue(e)){if(i.isDisabled(e)&&void 0!==t.direction)return e=e["up"===t.direction?"prev":"next"](),void i.setOption(e,{context:"auto-move",direction:t.direction});if(i.isDisabled(e))return;if(i.isMultiple()){var o=[],l=[];1===i.multipleOptions.length&&i.multipleOptions[0].hasClass(i.settings.classes.first)&&(i.getInput().empty(),i.multipleOptions[0].removeClass(i.settings.classes.selected),i.multipleOptions=[]),i.isSelected(e)?(i.multipleOptions=[],e.removeClass(i.settings.classes.selected),i.getOptions("."+i.settings.classes.selected).each(function(e,t){i.multipleOptions.push(u(t))}),0===i.multipleOptions.length&&setTimeout(function(){i.setOption("."+i.settings.classes.first,t)},0)):i.multipleOptions.push(e),i.multipleOptions.sort(function(e,t){var s=i.getOptions();return(e=s.index(e))===(t=s.index(t))?0:e<t?-1:1}),i.getInput().empty(),i.getOptions().removeClass(i.settings.classes.selected),u.each(i.multipleOptions,function(e,t){if(null!=(t=u(t))&&!i.isDisabled(t)){var s=i.getOptionValue(t),n=t.html();o.push(s),l.push(n),i.getInput().append(u("<option>",{value:s,html:n}).prop("selected",!0)),t.addClass(i.settings.classes.selected)}}),i.setLabel(l,o),void 0!==i.settings.onChange&&(s=u.extend(s,{options:i.multipleOptions}))}else{var n=i.getOptionValue(e),r=e.html();i.getInput().html(u("<option>",{value:n,html:r}).prop("selected",!0)),i.setLabel(r,n),i.getOptions().removeClass(i.settings.classes.selected),e.addClass(i.settings.classes.selected),void 0!==i.settings.onChange&&(s=u.extend(s,{option:e}))}"init"!==t.context&&(i.getInput().triggerHandler("change"),void 0!==i.settings.onChange&&(s=u.extend({customFormSelect:i,elements:i.getElements(),settings:t},s),i.settings.onChange.call(s)))}return i},removeOptions:function(e,s){var n=this;if(e=void 0===e||"string"==typeof e?n.getOptions(e):e,s=s||!1,n.isMultiple())return e.length&&u.each(e,function(e,t){t=u(t),n.isSelected(t)&&n.setOption(t,{context:"remove"}),s&&n.disableOption(t)}),n;n.customForm.setLog("warn",'removeOptions() works only with "multiple" attribute. Uses setOption() for classic <select>.')},disableOption:function(e){return e.addClass(this.settings.classes.disabled),this},isSelected:function(e){return e.hasClass(this.settings.classes.selected)},isDisabled:function(e){return e.hasClass(this.settings.classes.disabled)},isMultiple:function(){return this.multiple},getSiblings:function(){return this.getContext().find("."+this.settings.classes.prefix+"--"+this.getInputType()).not(this.getWrapper())},getElements:function(){return this.elements},getContext:function(){return this.getElements().context},getInput:function(){return this.getElements().input},getInputType:function(){return this.type},getWrapper:function(e){return void 0!==e?e.closest("."+this.settings.classes.prefix):this.getElements().wrapper},getWrapperInput:function(){return this.getElements().wrapperInput},getWrapperLabel:function(){return this.getElements().wrapperLabel},getWrapperOptions:function(){return this.getElements().wrapperOptions},getOptions:function(e){var t=this.getWrapperOptions().find("."+this.settings.classes.option);return void 0!==e?t.filter(e):t},getSourceOptions:function(){return this.getElements().source.options},getSourceOptgroups:function(){return this.getElements().source.optgroups},getValue:function(e){var t=(e=e||!1)?this.getInput().attr("data-default-value"):this.getWrapperLabel().attr("data-value");return void 0!==t&&this.isMultiple()?t.split(","):t},getCurrentValue:function(){return this.getValue()},getDefaultValue:function(){return this.getValue(!0)},getOptionValue:function(e){return void 0!==e?e.attr("data-value"):null}}}(jQuery);