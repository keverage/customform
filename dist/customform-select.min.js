!function(e){"use strict";e.CustomFormSelect=function(t,s){this.CustomForm=t,this.element={context:this.CustomForm.elementContext,input:this.CustomForm.elementInput,type:this.CustomForm.support.type,isMultiple:this.CustomForm.elementInput.prop("multiple"),wrapper:null,wrapperInput:null,source:{options:null,optgroups:null},wrapperLabel:null,wrapperOptions:null},this.element.isMultiple&&(this.element.multipleOptions=[]),e.extend(!0,this.settings={},this.CustomForm.settings,e.CustomFormSelect.defaults,s),this.keyup={timeout:null,keyCodeToKey:{48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9"},search:[],options:{}},this.optionsData={},this.prepareOptions()&&this.load()},e.CustomFormSelect.defaults={classes:{label:"{prefix}-selectLabel",options:"{prefix}-selectOptions",option:"{prefix}-selectOption",optionGroup:"{prefix}-selectOptionGroup",optionGroupLabel:"{prefix}-selectOptionGroupLabel",first:"is-first",selected:"is-selected",multiple:"is-multiple",open:"is-open"},multipleOptionsSeparator:", ",onLoad:void 0,beforeWrap:void 0,afterEventsHandler:void 0,onComplete:void 0,onClick:void 0,onChange:void 0,onReset:void 0},e.CustomFormSelect.prototype={prepareOptions:function(){return this.CustomForm.replacePrefixClass.call(this),!0},load:function(){void 0!==this.settings.onLoad&&this.settings.onLoad.call({CustomFormSelect:this,element:this.element}),this.wrap(),this.initElementsState(),this.eventsHandler(),this.resetHandler(),void 0!==this.settings.onComplete&&this.settings.onComplete.call({CustomFormSelect:this,element:this.element})},wrap:function(){var t=this;t.element.wrapper=e("<span>",{class:t.settings.classes.prefix+" "+t.settings.classes.prefix+"--select"}),t.element.wrapperInput=e("<span>",{class:t.settings.classes.input,tabindex:t.settings.tabindexStart}),void 0!==t.settings.beforeWrap&&t.settings.beforeWrap.call({CustomForm:t,wrapper:t.element.wrapper,wrapperInput:t.element.wrapperInput}),t.getInput().parent().wrapInner(t.element.wrapper),t.element.wrapper=t.getInput().parent(),t.getInput().wrap(t.element.wrapperInput),t.element.wrapperInput=t.element.input.parent(),t.element.source.options=t.getInput().children("option"),t.element.source.optgroups=t.getInput().children("optgroup"),t.getWrapperInput().append(e("<span>",{class:t.settings.classes.label})),t.element.wrapperLabel=t.getInput().next(),t.getWrapperInput().append(e("<span>",{class:t.settings.classes.options})),t.element.wrapperOptions=t.getWrapperLabel().next(),t.getWrapperInput().removeAttr("tabindex"),t.getWrapperLabel().attr("tabindex",t.settings.tabindexStart),t.element.isMultiple&&t.getWrapper().addClass(t.settings.classes.multiple),t.getSourceOptions().length&&e.each(t.getSourceOptions(),function(s,n){n=e(n);var i=n.attr("class");t.getWrapperOptions().append(e("<span>",{class:t.settings.classes.option+(void 0!==i?" "+i:"")+(void 0!==n.attr("disabled")?" "+t.settings.classes.disabled:""),"data-value":n.val(),html:n.html()}))}),t.getSourceOptgroups().length&&e.each(t.getSourceOptgroups(),function(s,n){n=e(n);var i=e("<span>",{class:t.settings.classes.optionGroup});e("<span>",{class:t.settings.classes.optionGroupLabel,html:n.attr("label")}).appendTo(i),n.children("option").each(function(s,n){n=e(n);var l=n.attr("class");e("<span>",{class:t.settings.classes.option+(void 0!==l?" "+l:"")+(void 0!==n.attr("disabled")?" "+t.settings.classes.disabled:""),"data-value":n.val(),html:n.html()}).appendTo(i)}),t.getWrapperOptions().append(i)}),t.getOptions().first().addClass(t.settings.classes.first)},initElementsState:function(){var t=this,s=t.getInput().attr("data-default-value");if(t.getInput().is(":disabled")&&(t.getWrapper().addClass(t.settings.classes.disabled),t.getInput().removeAttr("tabindex"),t.getWrapperLabel().removeAttr("tabindex")),void 0===s){if(s=t.getSourceOptions().filter("[selected]"),0===s.length&&(s=t.getSourceOptions().first()),s.length>1){var n=[];e.each(s,function(){n.push(e(this).val())}),s=n.join(",")}else s=s.val();t.getInput().attr("data-default-value",s)}return t.getOptions().each(function(){var n=e(this),i=n.attr("data-value");t.element.isMultiple?e.each(s.split(","),function(e,s){i===s&&t.setOptions.call(t,n)}):i===s&&t.setOption.call(t,n)}),t},eventsHandler:function(){var e=this;e.getWrapperLabel().on("click.open keyup.open",function(t){e.getInput().is(":disabled")||("click"===t.type&&e.clickHandler.call(e,t),"keyup"===t.type&&e.keyupHandler.call(e,t))}),void 0!==e.settings.afterEventsHandler&&e.settings.afterEventsHandler.call({CustomFormSelect:this,element:this.element})},resetHandler:function(){var t=this;t.getContext().on("reset",function(){var s=e(this);t.getWrapper().removeClass(t.settings.classes.disabled),setTimeout(function(){t.initElementsState(),void 0!==t.settings.onReset&&t.settings.onReset.call({CustomFormSelect:t,form:s})},0)})},preventHandler:function(){var t=this;t.closeSiblings(),t.getWrapperLabel().focus().one("click.close",function(){t.close.call(t)}),t.getWrapperLabel().one("blur.close",function(e){var s=!0;t.element.isMultiple&&t.getOptions().one("click.option",function(){s=!1}),setTimeout(function(){s&&t.close.call(t)},200)}),e(window).one("keydown.open",function(e){9!==e.keyCode&&e.preventDefault()})},close:function(){return this.getWrapper().removeClass(this.settings.classes.open),this.getWrapperLabel().off("click.close blur.close"),this.getOptions().off("click.option"),e(window).off("keydown.open"),this},closeSiblings:function(){var t=this,s=t.element.context.find("."+t.settings.classes.prefix+"--select").not(t.element.wrapper);return s.length&&s.each(function(){e(this).removeClass(t.settings.classes.open).find("."+t.settings.classes.label).off("click.close blur.close").end().find("."+t.settings.classes.option).off("click.option")}),t},clickHandler:function(t){var s=this;s.preventHandler.call(s),s.getWrapper().addClass(s.settings.classes.open),s.getOptions().on("click.option",function(){s[s.element.isMultiple?"setOptions":"setOption"].call(s,e(this))}),s.getInput().triggerHandler("click"),void 0!==s.settings.onClick&&s.settings.onClick.call({CustomFormSelect:s,event:t,wrapper:s.getWrapper(),input:s.getInput(),wrapperLabel:s.getWrapperLabel(),options:s.getOptions()})},keyupHandler:function(t){var s=this,n=37===t.keyCode||38===t.keyCode?"up":39===t.keyCode||40===t.keyCode?"down":void 0,i=35===t.keyCode?"last":36===t.keyCode?"first":void 0,l=27===t.keyCode||13===t.keyCode,o=t.keyCode>=48&&t.keyCode<=105;if(l)return void s.close.call(s);void 0===n&&void 0===i||s.preventHandler.call(s);var a=null,p=null,r=0;if(s.getOptions().each(function(t,n){var i=e(n);s.keyup.options[t]=i,i.hasClass(s.settings.classes.selected)&&(p=t),r++}),"up"===n)a=s.keyup.options[p-1];else if("down"===n)a=s.keyup.options[p+1];else if(void 0!==i)a="last"===i?s.keyup.options[r-1]:s.keyup.options[0];else if(o){var u=void 0!==t.key?t.key:s.keyup.keyCodeToKey[t.keyCode];void 0!==u&&(clearTimeout(s.keyup.timeout),s.keyup.search.push(u),s.keyup.timeout=setTimeout(function(){s.setOption.call(s,s.getOptionOnkeyup.call(s))},250))}s.element.isMultiple||s.setOption.call(s,a,{direction:n}),s.getInput().triggerHandler("keyup")},getOptionOnkeyup:function(){var t=this.keyup.search.join("",this.keyup.search),s=null,n=[];e.each(this.getOptions(),function(s,i){i=e(i),n.push(i.html().toLowerCase().indexOf(t))});var i=[];return e.each(n,function(e,t){t!==-1&&i.push(e)}),i.length&&(i=i.shift(),s=this.keyup.options[i]),this.keyup.search=[],s},setOption:function(t,s){if(s=s||{},null!==t&&void 0!==t&&void 0!==t.attr("data-value")){if(t.hasClass(this.settings.classes.disabled)&&void 0!==s.direction)return t=t["up"===s.direction?"prev":"next"](),void this.setOption.call(this,t,{direction:s.direction});if(t.length&&!t.hasClass(this.settings.classes.disabled)){var n=t.attr("data-value"),i=t.html();this.getInput().html(e("<option>",{value:n,html:i})),this.getWrapperLabel().attr("data-value",n).html(i),this.getOptions().removeClass(this.settings.classes.selected),t.addClass(this.settings.classes.selected),this.getInput().triggerHandler("change"),void 0!==this.settings.onChange&&this.settings.onChange.call({CustomFormSelect:this,wrapper:this.getWrapper(),input:this.getInput(),wrapperLabel:this.getWrapperLabel(),option:t})}}return this},setOptions:function(t){var s=this,n=[],i=[];if(null!==t&&void 0!==t&&void 0!==t.attr("data-value")){if(t.hasClass(s.settings.classes.disabled))return;1===s.element.multipleOptions.length&&s.element.multipleOptions[0].hasClass("is-first")&&(s.getInput().empty(),s.element.multipleOptions[0].removeClass(s.settings.classes.selected),s.element.multipleOptions=[]),t.hasClass(s.settings.classes.selected)?(s.element.multipleOptions=[],t.removeClass(s.settings.classes.selected),s.getOptions("."+s.settings.classes.selected).each(function(){s.element.multipleOptions.push(e(this))}),0===s.element.multipleOptions.length&&setTimeout(function(){s.setOption.call(s,s.getOptions("."+s.settings.classes.first))},0)):s.element.multipleOptions.push(t),s.element.multipleOptions.sort(function(e,t){var n=s.getOptions();return e=n.index(e),t=n.index(t),e===t?0:e<t?-1:1}),s.getInput().empty(),s.getOptions().removeClass(s.settings.classes.selected),e.each(s.element.multipleOptions,function(t,l){if(l=e(l),null!==l&&void 0!==l&&!l.hasClass(s.settings.classes.disabled)){var o=l.attr("data-value"),a=l.html();n.push(o),i.push(a),s.getInput().append(e("<option>",{value:o,html:a}).prop("selected",!0)),l.addClass(s.settings.classes.selected)}}),s.getWrapperLabel().attr("data-value",n.join(",")).html(i.join(s.settings.multipleOptionsSeparator)),s.getInput().triggerHandler("change"),void 0!==s.settings.onChange&&s.settings.onChange.call({CustomFormSelect:this,wrapper:s.getWrapper(),input:s.getInput(),wrapperLabel:s.getWrapperLabel(),options:s.element.multipleOptions})}return s},removeOptions:function(t,s){var n=this;return t="string"==typeof t?n.getOptions(t):t,s=s||!1,t.length&&e.each(t,function(){var t=e(this);t.hasClass(n.settings.classes.selected)&&n.setOptions(t),s&&n.disableOption(t)}),n},disableOption:function(e){return e.addClass(this.settings.classes.disabled),this},getContext:function(){return this.element.context},getInput:function(){return this.element.input},getWrapper:function(e){return void 0!==e?e.closest("."+this.settings.classes.prefix):this.element.wrapper},getWrapperInput:function(){return this.element.wrapperInput},getWrapperLabel:function(){return this.element.wrapperLabel},getWrapperOptions:function(){return this.element.wrapperOptions},getOptions:function(e){var t=this.getWrapperOptions().find("."+this.settings.classes.option);return void 0!==e?t.filter(e):t},getSourceOptions:function(){return this.element.source.options},getSourceOptgroups:function(){return this.element.source.optgroups},getValue:function(e){e=e||!1;var t=e?this.getInput().attr("data-default-value"):this.getWrapperLabel().attr("data-value");return this.element.isMultiple?t.split(","):t},getDefaultValue:function(){return this.getValue(!0)},getOptionValue:function(e){return e=e||void 0,void 0!==e&&(e.attr("data-value")||null)}}}(jQuery);